@page "/fetchusers"
@using System.Net.Http.Json
@inject HttpClient Http

<PageTitle>Fetch Data</PageTitle>

<div class="fetch-data-container">
    <h1>User Data</h1>
    <p class="subtitle">Fetch and display user information from external API</p>

    <div class="alert alert-primary shadow-sm mb-4">
        <h5 class="alert-heading"><i class="bi bi-cloud-arrow-down me-2"></i>HTTP GET Request Demo</h5>
        <p class="mb-2">This page demonstrates using <strong>HttpClient</strong> to make GET requests to:</p>
        <code class="d-block bg-light p-2 rounded mb-2">https://jsonplaceholder.typicode.com/users</code>
        <p class="mb-0"><small>Click the button below to fetch user data from the API.</small></p>
    </div>

    <button class="btn btn-primary mb-3" @onclick="FetchUsers">
        <span class="bi bi-arrow-repeat"></span> Fetch New Users
    </button>

    @if (isLoading)
    {
        <div class="text-center my-4">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading users...</p>
        </div>
    }
    else if (!string.IsNullOrEmpty(errorMessage))
    {
        <div class="alert alert-danger" role="alert">
            <strong>Error:</strong> @errorMessage
        </div>
    }
    else if (users != null && users.Count > 0)
    {
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th scope="col">User ID</th>
                        <th scope="col">Name</th>
                        <th scope="col">Email</th>
                        <th scope="col">City</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var user in users)
                    {
                        <tr>
                            <td><strong>@user.Id</strong></td>
                            <td>@user.Name</td>
                            <td><a href="mailto:@user.Email">@user.Email</a></td>
                            <td>@user.Address.City</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <div class="results-summary">
            <small class="text-muted">Showing @users.Count users</small>
        </div>
    }
    else
    {
        <div class="alert alert-info" role="alert">
            <span class="bi bi-info-circle"></span> No users available. Click the button above to fetch users.
        </div>
    }
</div>


@code {
    private List<User>? users;
    private bool isLoading = false;
    private string? errorMessage;

    private async Task  FetchUsers()
    {
        isLoading = true;
        errorMessage = null;
        StateHasChanged();

        try
        {
            // Call a nonexistent endpoint to simulate an error
            // users = await Http.GetFromJsonAsync<List<User>>("https://jsonplaceholder.typicode.com/invalidendpoint");

            users = await Http.GetFromJsonAsync<List<User>>("https://jsonplaceholder.typicode.com/users");
        }
        catch (Exception ex)
        {
            errorMessage = $"Error fetching users: {ex.Message}";
        }
        finally
        {
            isLoading = false;
            StateHasChanged();
        }
     }


    public class User
    {
        public int Id { get; set; }
        public required string Name { get; set; }
        public required string Email { get; set; } 
        public required Address Address { get; set; } 
    }

    public class Address
    {
        public required string Street { get; set; }
        public required string Suite { get; set; }
        public required string City { get; set; }
        public required string Zipcode { get; set; }
    }
}

<style>
    .fetch-data-container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .fetch-data-container h1 {
        color: #24292e;
        font-weight: 600;
        margin-bottom: 8px;
    }

    .subtitle {
        color: #586069;
        margin-bottom: 24px;
    }

    .table {
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        border-radius: 8px;
        overflow: hidden;
    }

    .table thead th {
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.875rem;
        letter-spacing: 0.5px;
    }

    .table tbody tr {
        transition: background-color 0.2s ease;
    }

    .table tbody tr:hover {
        background-color: rgba(0, 123, 255, 0.05);
    }

    .table td a {
        color: #0366d6;
        text-decoration: none;
    }

    .table td a:hover {
        text-decoration: underline;
    }

    .btn-primary {
        padding: 10px 20px;
        font-weight: 500;
    }

    .results-summary {
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid #e1e4e8;
    }
</style>